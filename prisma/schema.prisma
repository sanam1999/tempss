generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           BigInt            @id @default(autoincrement())
  email        String            @unique
  passwordHash String
  resetToken   String?           @unique
  resetExpires DateTime?
  createdAt    DateTime          @default(now())
  receipts     CustomerReceipt[]
}

model CustomerReceipt {
  id                      BigInt                    @id @default(autoincrement())
  permitNo                String                    @default("DEF/RD/6000")
  serialNumber            String                    @unique
  receiptDate             DateTime
  customerName            String?
  nicPassport             String?
  sourceOfForeignCurrency String?
  remarks                 String?
  createdAt               DateTime                  @default(now())
  createdById             BigInt?
  createdBy               User?                     @relation(fields: [createdById], references: [id])
  currencies              CustomerReceiptCurrency[]
  pdfs                    ReceiptPDF?
}

model CustomerReceiptCurrency {
  id              BigInt   @id @default(autoincrement())
  receiptId       BigInt
  currencyType    String
  amountFcy       Decimal  @db.Decimal(18, 4)
  rateOffered     Decimal  @db.Decimal(18, 4)
  amountIssuedLkr Decimal  @db.Decimal(18, 4)

  receipt CustomerReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  
  @@index([currencyType, receiptId])
}

model ReceiptPDF {
  id        BigInt          @id @default(autoincrement())
  receiptId BigInt          @unique
  fileName  String
  filePath  String
  createdAt DateTime
  receipt   CustomerReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
}

model DepositRecord {
  id           BigInt   @id @default(autoincrement())
  currencyType String
  amount       Decimal  @db.Decimal(18, 4)
  date         DateTime
  createdAt    DateTime @default(now())

  @@index([currencyType, date])
}

model CurrencyOpeningBalance {
  id           BigInt   @id @default(autoincrement())
  currencyType String
  date         DateTime
  amount       Decimal  @db.Decimal(18, 4)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([currencyType, date])
  @@index([currencyType, date])
}

model ExchangeTransaction {
  id           BigInt   @id @default(autoincrement())
  date         DateTime
  fromCurrency String
  toCurrency   String
  fromAmount   Decimal  @db.Decimal(18, 4)
  toAmount     Decimal  @db.Decimal(18, 4)
  rate         Decimal  @db.Decimal(18, 4)
  createdAt    DateTime @default(now())

  @@index([fromCurrency, date])
  @@index([toCurrency, date])
}

model SaleTransaction {
  id           BigInt   @id @default(autoincrement())
  date         DateTime
  currencyType String
  amount       Decimal  @db.Decimal(18, 4)
  createdAt    DateTime @default(now())

  @@index([currencyType, date])
}