generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           BigInt            @id @default(autoincrement())
  email        String            @unique
  passwordHash String
  resetToken   String?           @unique
  resetExpires DateTime?
  createdAt    DateTime          @default(now())
  receipts     CustomerReceipt[]
}

model CustomerReceipt {
  id                      BigInt                    @id @default(autoincrement())
  permitNo                String                    @default("DEF/RD/6000")
  serialNumber            String                    @unique
  receiptDate             DateTime
  customerName            String?
  nicPassport             String?
  sourceOfForeignCurrency String?
  remarks                 String?
  createdAt               DateTime                  @default(now())
  createdById             BigInt?
  createdBy               User?                     @relation(fields: [createdById], references: [id])
  currencies              CustomerReceiptCurrency[]
  pdfs                    ReceiptPDF?
}

model CustomerReceiptCurrency {
  id              BigInt   @id @default(autoincrement())
  receiptId       BigInt
  currencyType    String
  amountFcy       Decimal
  rateOffered     Decimal
  amountIssuedLkr Decimal

  receipt CustomerReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
}


model ReceiptPDF {
  id        BigInt          @id @default(autoincrement())
  receiptId BigInt          @unique
  fileName  String
  filePath  String
  createdAt DateTime
  receipt   CustomerReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
}

model DailyCurrencyBalance {
  id             BigInt   @id @default(autoincrement())
  currencyType   String
  date           DateTime
  openingBalance Decimal  @default(0) @db.Decimal(18, 4)
  purchases      Decimal  @default(0) @db.Decimal(18, 4)
  exchangeBuy    Decimal  @default(0) @db.Decimal(18, 4)
  exchangeSell   Decimal  @default(0) @db.Decimal(18, 4)
  sales          Decimal  @default(0) @db.Decimal(18, 4)
  deposits       Decimal  @default(0) @db.Decimal(18, 4)
  closingBalance Decimal  @default(0) @db.Decimal(18, 4)

  @@unique([currencyType, date])
}

model DepositRecord {
  id           BigInt   @id @default(autoincrement())
  currencyType String
  amount       Decimal  @db.Decimal(18, 4)
  date         DateTime
  createdAt    DateTime @default(now())

  @@index([currencyType, date])
}
